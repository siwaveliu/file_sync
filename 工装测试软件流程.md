---
title: 工装测试软件流程
tags: 矽久,文档,版本
grammar_cjkRuby: true
grammar_mindmap: true
renderNumberedHeading: true
grammar_code: true
grammar_decorate: true
grammar_mathjax: true
---


[toc!?direction=lr]

---
|修订内容|版本号|修订人|
|-|-|-|
初始未完成|0.1|刘博强

# 工装测试
1.每个测试项独立由工装主控完成；
2.工装通过参数设置获取评判标准；
3.根据评判标准上报测试结果；
4.如果没有设置参数，在启动测试时返回否认帧（异常响应-无参数配置）；
5.工装未插入模块时保持RST为高，EVENT为低。
6.与上位机的串口接口uart1是 ***921600，N，8，1***
7.与待测DUT串口接口uart0是 ***9600，E，8，1***
8.工装上有一个PIN是模块插入PIN，通过中断来判断模块是否插入
9.模块插入后需要给模块回复表地址，地址使用工装的ID生成
10.与PC接口uart1，与DUT接口uart2
11.表地址回复使用645-2007
12.模块插入时开始计时t_start，为后面测试超级电容做准备。
13.如果收到 ***停止文件传输测试帧*** 工装检测到模块插入后不再主动烧写程序
14.强弱电继电器默认在弱电开关

## 程序烧写
1.模块插入后检查是否允许文件传输
2.检查缓存区是否有烧写文件
3.通过spi烧写程序
4.烧写完成后，复位dut，收到读取表地址帧，表示程序烧写成功

## 版本号测试
1.通过读取模块信息帧读取版本号。
2.对比参数配置内容，判读结果。
3.发送 ***版本号测试结果*** 报文给上位机

## ID写入测试
1.上位机下发***启动ID写入测试帧***
2.将已待写入的ID缓存一份
3.将通过 ***ID写入命令*** 将ID写入DUT
4.***ID读取命令*** 读取ID与缓存比较
5.发送 ***ID写入测试结果*** 报文给上位机

## ID读取测试
1.上位机下发***启动ID读取测试帧***
2.通过uart0发送 ***ID读取命令***
3.将收到的ID通过 ***ID读取测试结果*** 上报给上位机

## PIN和电压测试
包含RXD/RST/EVENT/TXD/STA/1.2V/3.3V
其中TXD/STA/1.2V/3.3V会通过ADC来测量电平值

### RXD/RST/TXD/STA
1.模块插入后dut读取表地址，之后不再读取，RXD=ok。
2.拉低RST持续100ms，拉高。
3.如果收到dut读取表地址命令那么RST=ok。
4.在RST拉低后，用AD测量TXD，低电平=0v，高电平在参数配置区间，TXD=ok
5.在dut读取表地址后，STA会输出200ms高电平，用AD测量STA电平是否为参数配置区间-200ms；之后应该恢复0V。STA=ok

### 1.2V/3.3V
1.使用AD测量1.2V和3.3V 在参数配置区间

### EVENT
1.拉高EVENT_PIN 100ms，拉低。
2.uart2收到读取事件645指令，EVENT = ok

发送 ***功耗测试结果*** 报文给上位机

## 频偏测试
1.调用 ***发送信标帧*** 函数
2.发送 ***读取远程信道参数***
3.回复报文中timeout=0，en_tfo=1,频偏值有效；tfo在预设范围内 pass

## 通信测试
1.工装发送读取远程信道参数报文
2.收到远程信道参数报文回复。记录报文中的snr、rssi和接收H信息
3.读取本地信道参数，记录snr、rssi和接收H信息
4.重复步骤2和3，允许2失败一次，即未收到回复报文；3次结果取平均值，在参数配置范围内pass。
5.发送 ***通信测试结果*** 报文给上位机

## 过零电路测试
1.切换继电器到强电开关
2.通过uart0发送 ***读取模块状态帧***
3.切换继电器开关到弱电
4.发送 ***过零测试结果*** 报文给上位机

## 功耗测试
需要保证从模块插入供电开始，到现在时间已经＞20s。

1.读取功耗芯片电流值，符合配置参数范围pass
2.通过uart0给dut发送 ***开启连续发送帧***延时100ms，读取功耗芯片电流值，符合配置参数范围pass
3.通过uart0给dut发送 ***关闭连续发送帧***
4.发送 ***功耗测试结果*** 报文给上位机

## 停电上报测试
1.工装将dut供电电源开关关闭。
2.延迟1000ms
3.工装通过uart0读取dut停电flash标记位，如果结果=1，pass。
4.发送 ***停电上报结果*** 报文给上位机



